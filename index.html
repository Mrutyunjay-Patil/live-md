<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Markdown Editor & Preview</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/5.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.3/purify.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #fafafa;
            height: 100vh;
            overflow: hidden;
        }

        .app {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: white;
            border-bottom: 1px solid #e1e5e9;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 60px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: #2d3748;
        }

        .privacy-notice {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            color: #0369a1;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .main-content {
            flex: 1;
            display: flex;
            background: white;
        }

        .editor-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            border-right: 1px solid #e1e5e9;
        }

        .toolbar {
            background: #fafafa;
            border-bottom: 1px solid #e1e5e9;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-wrap: wrap;
        }

        .toolbar-btn {
            background: transparent;
            border: 1px solid transparent;
            border-radius: 4px;
            padding: 6px 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            color: #6b7280;
            min-width: 32px;
            height: 32px;
        }

        .toolbar-btn:hover {
            background: #e5e7eb;
            color: #374151;
        }

        .toolbar-btn.active {
            background: #dbeafe;
            color: #1d4ed8;
            border-color: #93c5fd;
        }

        .toolbar-separator {
            width: 1px;
            height: 20px;
            background: #e1e5e9;
            margin: 0 4px;
        }

        .editor-container {
            flex: 1;
            position: relative;
        }

        #markdown-input {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            padding: 24px;
            font-family: 'JetBrains Mono', 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.6;
            resize: none;
            background: white;
            color: #2d3748;
        }

        #markdown-input::placeholder {
            color: #9ca3af;
        }

        .resizer {
            width: 4px;
            background: #e1e5e9;
            cursor: col-resize;
            position: relative;
            transition: background 0.15s ease;
        }

        .resizer:hover {
            background: #9ca3af;
        }

        .resizer.resizing {
            background: #3b82f6;
        }

        .preview-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .preview-header {
            background: #fafafa;
            border-bottom: 1px solid #e1e5e9;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 49px;
        }

        .preview-title {
            font-size: 14px;
            font-weight: 500;
            color: #6b7280;
        }

        .preview-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 6px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #374151;
            transition: all 0.15s ease;
        }

        .action-btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .action-btn:active {
            transform: translateY(1px);
        }

        #preview-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: white;
            line-height: 1.7;
        }

        /* Markdown Preview Styles */
        #preview-content h1 { 
            font-size: 32px; 
            font-weight: 700; 
            margin: 0 0 16px 0; 
            color: #111827; 
            line-height: 1.2;
        }
        
        #preview-content h2 { 
            font-size: 24px; 
            font-weight: 600; 
            margin: 32px 0 16px 0; 
            color: #1f2937; 
            line-height: 1.3;
        }
        
        #preview-content h3 { 
            font-size: 20px; 
            font-weight: 600; 
            margin: 24px 0 12px 0; 
            color: #374151; 
            line-height: 1.4;
        }
        
        #preview-content h4, #preview-content h5, #preview-content h6 { 
            font-size: 16px; 
            font-weight: 600; 
            margin: 20px 0 8px 0; 
            color: #4b5563; 
        }

        #preview-content p { 
            margin: 16px 0; 
            color: #374151; 
        }
        
        #preview-content strong { 
            font-weight: 600; 
            color: #111827; 
        }
        
        #preview-content em { 
            font-style: italic; 
        }
        
        #preview-content code { 
            background: #f3f4f6; 
            padding: 2px 6px; 
            border-radius: 4px; 
            font-family: 'JetBrains Mono', monospace; 
            font-size: 13px; 
            color: #dc2626; 
        }
        
        #preview-content pre { 
            background: #f8fafc; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            padding: 16px; 
            margin: 20px 0; 
            overflow-x: auto; 
        }
        
        #preview-content pre code { 
            background: none; 
            padding: 0; 
            color: #374151; 
        }

        #preview-content ul, #preview-content ol { 
            margin: 16px 0; 
            padding-left: 24px; 
        }
        
        #preview-content li { 
            margin: 6px 0; 
            color: #374151; 
        }

        #preview-content blockquote { 
            border-left: 3px solid #3b82f6; 
            background: #f8fafc; 
            padding: 16px 20px; 
            margin: 20px 0; 
            color: #4b5563; 
        }

        #preview-content a { 
            color: #3b82f6; 
            text-decoration: none; 
        }
        
        #preview-content a:hover { 
            text-decoration: underline; 
        }

        #preview-content table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
        }
        
        #preview-content th, #preview-content td { 
            border-bottom: 1px solid #e5e7eb; 
            padding: 12px 16px; 
            text-align: left; 
        }
        
        #preview-content th { 
            background: #f9fafb; 
            font-weight: 600; 
            color: #374151;
        }

        #preview-content hr { 
            border: none; 
            height: 1px; 
            background: #e5e7eb; 
            margin: 32px 0; 
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: #ef4444;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .resizer {
                height: 4px;
                width: 100%;
                cursor: row-resize;
            }

            .privacy-notice {
                font-size: 12px;
            }

            .toolbar {
                padding: 6px 12px;
            }

            #markdown-input, #preview-content {
                padding: 16px;
            }
        }

        /* SVG Icons */
        .icon {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        .lock-icon {
            width: 14px;
            height: 14px;
            fill: #0369a1;
        }

        .github-link {
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 6px;
            transition: background 0.15s ease;
            text-decoration: none;
        }

        .github-link:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .github-icon {
            width: 20px;
            height: 20px;
            fill: #374151;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <div class="header-left">
                <div class="logo">Live Markdown Editor</div>
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <div class="privacy-notice">
                    <svg class="lock-icon" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                    </svg>
                    <span>Privacy First: Everything stays in your browser. No data stored.</span>
                </div>
                <a href="https://github.com/Mrutyunjay-Patil/live-md" target="_blank" class="github-link" title="View on GitHub">
                    <svg class="github-icon" viewBox="0 0 24 24">
                        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="main-content">
            <div class="editor-panel">
                <div class="toolbar">
                    <button class="toolbar-btn" onclick="toggleFormat('bold')" title="Bold (Ctrl+B)">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M15.6 10.79c.97-.67 1.65-1.77 1.65-2.79 0-2.26-1.75-4-4-4H7v14h7.04c2.09 0 3.71-1.7 3.71-3.79 0-1.52-.86-2.82-2.15-3.42zM10 6.5h3c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5h-3v-3zm3.5 9H10v-3h3.5c.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="toggleFormat('italic')" title="Italic (Ctrl+I)">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M10 4v3h2.21l-3.42 8H6v3h8v-3h-2.21l3.42-8H18V4h-8z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="toggleFormat('code')" title="Inline Code">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                        </svg>
                    </button>
                    
                    <div class="toolbar-separator"></div>
                    
                    <button class="toolbar-btn" onclick="toggleFormat('h1')" title="Heading 1">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M5 4v3h5.5v10h3V7H19V4z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="toggleFormat('h2')" title="Heading 2">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M5 4v3h5.5v10h3V7H19V4z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="toggleFormat('h3')" title="Heading 3">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M5 4v3h5.5v10h3V7H19V4z"/>
                        </svg>
                    </button>
                    
                    <div class="toolbar-separator"></div>
                    
                    <button class="toolbar-btn" onclick="insertFormat('link')" title="Link (Ctrl+K)">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormat('image')" title="Image">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/>
                        </svg>
                    </button>
                    
                    <div class="toolbar-separator"></div>
                    
                    <button class="toolbar-btn" onclick="insertFormat('ul')" title="Bullet List">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormat('ol')" title="Numbered List">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M2 17h2v.5H3v1h1v.5H2v1h3v-4H2v1zm1-9h1V4H2v1h1v3zm-1 3h1.8L2 13.1v.9h3v-1H3.2L5 10.9V10H2v1zm5-6v2h14V5H7zm0 14h14v-2H7v2zm0-6h14v-2H7v2z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormat('quote')" title="Quote">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormat('code-block')" title="Code Block">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0L19.2 12l-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/>
                        </svg>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormat('hr')" title="Horizontal Rule">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M19 13H5v-2h14v2z"/>
                        </svg>
                    </button>
                </div>

                <div class="editor-container">
                    <textarea id="markdown-input" placeholder="Start typing your markdown here...

# Welcome to the Live Markdown Editor

This is a **real-time** markdown editor with instant preview.

## Features
- âœ… Live preview as you type
- âœ… Professional toolbar with toggle functionality  
- âœ… Copy formatted content to clipboard
- âœ… Download as PDF
- âœ… Resizable split view
- âœ… Privacy-first (nothing stored on servers)

### Quick Start
Try the toolbar buttons above or use keyboard shortcuts:
- **Ctrl+B** for bold
- **Ctrl+I** for italic  
- **Ctrl+K** for links

```javascript
// Code blocks are supported
console.log('Happy writing!');
```

> This is a blockquote for important notes

Start editing to see the magic happen! ðŸš€"></textarea>
                </div>
            </div>

            <div class="resizer" id="resizer"></div>

            <div class="preview-panel">
                <div class="preview-header">
                    <div class="preview-title">Live Preview</div>
                    <div class="preview-actions">
                        <button class="action-btn" onclick="copyToClipboard()" id="copy-btn" title="Copy to clipboard">
                            <svg class="icon copy-icon" viewBox="0 0 24 24">
                                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                            </svg>
                            <svg class="icon check-icon" viewBox="0 0 24 24" style="display: none;">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                        </button>
                        <button class="action-btn" onclick="downloadPDF()" title="Download as PDF">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="preview-content"></div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        const markdownInput = document.getElementById('markdown-input');
        const previewContent = document.getElementById('preview-content');
        const resizer = document.getElementById('resizer');
        const editorPanel = document.querySelector('.editor-panel');
        const previewPanel = document.querySelector('.preview-panel');

        // Configure marked
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false,
            mangle: false
        });

        function updatePreview() {
            const markdownText = markdownInput.value;
            const htmlContent = marked.parse(markdownText);
            const cleanHtml = DOMPurify.sanitize(htmlContent);
            previewContent.innerHTML = cleanHtml;
        }

        function getSelectedText() {
            const start = markdownInput.selectionStart;
            const end = markdownInput.selectionEnd;
            return {
                start,
                end,
                selectedText: markdownInput.value.substring(start, end),
                beforeText: markdownInput.value.substring(0, start),
                afterText: markdownInput.value.substring(end)
            };
        }

        function replaceSelection(newText, selectStart = null, selectEnd = null) {
            const { start, beforeText, afterText } = getSelectedText();
            markdownInput.value = beforeText + newText + afterText;
            
            if (selectStart !== null) {
                markdownInput.setSelectionRange(start + selectStart, start + (selectEnd || selectStart));
            }
            
            markdownInput.focus();
            updatePreview();
        }

        function toggleFormat(type) {
            const { selectedText, beforeText, afterText, start, end } = getSelectedText();
            
            // Update button states
            updateToolbarStates();
            
            switch (type) {
                case 'bold':
                    if (selectedText.startsWith('**') && selectedText.endsWith('**')) {
                        replaceSelection(selectedText.slice(2, -2));
                    } else if (beforeText.endsWith('**') && afterText.startsWith('**')) {
                        markdownInput.value = beforeText.slice(0, -2) + selectedText + afterText.slice(2);
                        markdownInput.setSelectionRange(start - 2, end - 2);
                    } else {
                        replaceSelection(`**${selectedText}**`, 2, 2 + selectedText.length);
                    }
                    break;
                    
                case 'italic':
                    if (selectedText.startsWith('*') && selectedText.endsWith('*') && !selectedText.startsWith('**')) {
                        replaceSelection(selectedText.slice(1, -1));
                    } else if (beforeText.endsWith('*') && afterText.startsWith('*') && !beforeText.endsWith('**')) {
                        markdownInput.value = beforeText.slice(0, -1) + selectedText + afterText.slice(1);
                        markdownInput.setSelectionRange(start - 1, end - 1);
                    } else {
                        replaceSelection(`*${selectedText}*`, 1, 1 + selectedText.length);
                    }
                    break;
                    
                case 'code':
                    if (selectedText.startsWith('`') && selectedText.endsWith('`')) {
                        replaceSelection(selectedText.slice(1, -1));
                    } else if (beforeText.endsWith('`') && afterText.startsWith('`')) {
                        markdownInput.value = beforeText.slice(0, -1) + selectedText + afterText.slice(1);
                        markdownInput.setSelectionRange(start - 1, end - 1);
                    } else {
                        replaceSelection(`\`${selectedText}\``, 1, 1 + selectedText.length);
                    }
                    break;
                    
                case 'h1':
                case 'h2':
                case 'h3':
                    const level = type[1];
                    const hashes = '#'.repeat(level);
                    const lineStart = beforeText.lastIndexOf('\n') + 1;
                    const lineEnd = beforeText.length + selectedText.length + afterText.indexOf('\n');
                    const currentLine = markdownInput.value.substring(lineStart, lineEnd === -1 ? undefined : lineEnd);
                    
                    if (currentLine.startsWith(hashes + ' ')) {
                        const newLine = currentLine.replace(new RegExp(`^#{1,6} `), '');
                        markdownInput.value = markdownInput.value.substring(0, lineStart) + newLine + markdownInput.value.substring(lineEnd === -1 ? markdownInput.value.length : lineEnd);
                    } else {
                        const newLine = currentLine.replace(/^#{1,6} /, '');
                        markdownInput.value = markdownInput.value.substring(0, lineStart) + hashes + ' ' + newLine + markdownInput.value.substring(lineEnd === -1 ? markdownInput.value.length : lineEnd);
                    }
                    break;
            }
            
            updatePreview();
        }

        function insertFormat(type) {
            const { selectedText } = getSelectedText();
            
            switch (type) {
                case 'link':
                    if (selectedText) {
                        replaceSelection(`[${selectedText}](url)`, selectedText.length + 3, selectedText.length + 6);
                    } else {
                        replaceSelection('[text](url)', 1, 5);
                    }
                    break;
                    
                case 'image':
                    replaceSelection('![alt text](image-url)', 2, 10);
                    break;
                    
                case 'ul':
                    if (selectedText) {
                        const lines = selectedText.split('\n').map(line => `- ${line}`).join('\n');
                        replaceSelection(lines);
                    } else {
                        replaceSelection('- ', 2);
                    }
                    break;
                    
                case 'ol':
                    if (selectedText) {
                        const lines = selectedText.split('\n').map((line, i) => `${i + 1}. ${line}`).join('\n');
                        replaceSelection(lines);
                    } else {
                        replaceSelection('1. ', 3);
                    }
                    break;
                    
                case 'quote':
                    if (selectedText) {
                        const lines = selectedText.split('\n').map(line => `> ${line}`).join('\n');
                        replaceSelection(lines);
                    } else {
                        replaceSelection('> ', 2);
                    }
                    break;
                    
                case 'code-block':
                    if (selectedText) {
                        replaceSelection(`\`\`\`\n${selectedText}\n\`\`\``, 4, 4 + selectedText.length);
                    } else {
                        replaceSelection('```\ncode\n```', 4, 8);
                    }
                    break;
                    
                case 'hr':
                    replaceSelection('\n---\n', 5);
                    break;
            }
        }

        function updateToolbarStates() {
            const { selectedText, beforeText, afterText } = getSelectedText();
            
            // Reset all active states
            document.querySelectorAll('.toolbar-btn').forEach(btn => btn.classList.remove('active'));
            
            // Check for active formats
            if ((selectedText.startsWith('**') && selectedText.endsWith('**')) || 
                (beforeText.endsWith('**') && afterText.startsWith('**'))) {
                document.querySelector('[onclick="toggleFormat(\'bold\')"]').classList.add('active');
            }
            
            if ((selectedText.startsWith('*') && selectedText.endsWith('*') && !selectedText.startsWith('**')) || 
                (beforeText.endsWith('*') && afterText.startsWith('*') && !beforeText.endsWith('**'))) {
                document.querySelector('[onclick="toggleFormat(\'italic\')"]').classList.add('active');
            }
            
            if ((selectedText.startsWith('`') && selectedText.endsWith('`')) || 
                (beforeText.endsWith('`') && afterText.startsWith('`'))) {
                document.querySelector('[onclick="toggleFormat(\'code\')"]').classList.add('active');
            }
        }

        function copyToClipboard() {
            const htmlContent = previewContent.innerHTML;
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = htmlContent;
            
            if (navigator.clipboard && navigator.clipboard.write) {
                const plainText = tempDiv.textContent || tempDiv.innerText || '';
                const htmlBlob = new Blob([htmlContent], { type: 'text/html' });
                const textBlob = new Blob([plainText], { type: 'text/plain' });
                
                const clipboardItem = new ClipboardItem({
                    'text/html': htmlBlob,
                    'text/plain': textBlob
                });
                
                navigator.clipboard.write([clipboardItem]).then(() => {
                    showCopySuccess();
                    showNotification('Content copied to clipboard!');
                }).catch(() => {
                    fallbackCopy(plainText);
                });
            } else {
                fallbackCopy(tempDiv.textContent || tempDiv.innerText || '');
            }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showCopySuccess();
                showNotification('Content copied to clipboard!');
            } catch (err) {
                showNotification('Copy failed. Please try again.', 'error');
            }
            document.body.removeChild(textArea);
        }

        function showCopySuccess() {
            const copyBtn = document.getElementById('copy-btn');
            const copyIcon = copyBtn.querySelector('.copy-icon');
            const checkIcon = copyBtn.querySelector('.check-icon');
            
            copyIcon.style.display = 'none';
            checkIcon.style.display = 'block';
            copyBtn.style.color = '#10b981';
            
            setTimeout(() => {
                copyIcon.style.display = 'block';
                checkIcon.style.display = 'none';
                copyBtn.style.color = '';
            }, 2000);
        }

        function downloadPDF() {
            // Create a new window for printing
            const printContent = previewContent.innerHTML;
            const printStyles = `
                <style>
                    @media print {
                        body { 
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; 
                            line-height: 1.6; 
                            max-width: none; 
                            margin: 0; 
                            padding: 20px;
                            color: black;
                        }
                        h1, h2, h3, h4, h5, h6 { 
                            margin-top: 0; 
                            page-break-after: avoid;
                            color: black;
                        }
                        pre { 
                            background: #f5f5f5; 
                            padding: 16px; 
                            border-radius: 4px; 
                            overflow-x: auto;
                            border: 1px solid #ddd;
                        }
                        code { 
                            background: #f5f5f5; 
                            padding: 2px 4px; 
                            border-radius: 3px; 
                        }
                        blockquote { 
                            border-left: 4px solid #ddd; 
                            margin: 0; 
                            padding-left: 20px; 
                            color: #666; 
                        }
                        table { 
                            border-collapse: collapse; 
                            width: 100%; 
                            page-break-inside: avoid;
                        }
                        th, td { 
                            border: 1px solid #ddd; 
                            padding: 8px; 
                            text-align: left; 
                        }
                        th { 
                            background-color: #f5f5f5; 
                        }
                        img {
                            max-width: 100%;
                            height: auto;
                        }
                        a {
                            color: #0066cc;
                        }
                    }
                </style>
            `;
            
            // Create a blob with the content
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                    <head>
                        <title>Markdown Document</title>
                        <meta charset="utf-8">
                        ${printStyles}
                    </head>
                    <body>
                        ${printContent}
                    </body>
                </html>
            `;
            
            const blob = new Blob([htmlContent], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            // Open in new window for printing
            const printWindow = window.open(url, '_blank');
            if (printWindow) {
                printWindow.addEventListener('load', () => {
                    setTimeout(() => {
                        printWindow.print();
                        URL.revokeObjectURL(url);
                    }, 100);
                });
            } else {
                // Fallback: trigger browser print dialog
                window.print();
                URL.revokeObjectURL(url);
            }
            
            showNotification('PDF download initiated!');
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification${type === 'error' ? ' error' : ''}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Event listeners
        markdownInput.addEventListener('input', updatePreview);
        markdownInput.addEventListener('selectionchange', updateToolbarStates);
        markdownInput.addEventListener('mouseup', updateToolbarStates);
        markdownInput.addEventListener('keyup', updateToolbarStates);

        // Keyboard shortcuts
        markdownInput.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key.toLowerCase()) {
                    case 'b':
                        e.preventDefault();
                        toggleFormat('bold');
                        break;
                    case 'i':
                        e.preventDefault();
                        toggleFormat('italic');
                        break;
                    case 'k':
                        e.preventDefault();
                        insertFormat('link');
                        break;
                }
            }
            
            if (e.key === 'Tab') {
                e.preventDefault();
                replaceSelection('  ', 2);
            }
        });

        // Resizer functionality
        let isResizing = false;

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            resizer.classList.add('resizing');
            document.addEventListener('mousemove', handleResize);
            document.addEventListener('mouseup', stopResize);
            e.preventDefault();
        });

        function handleResize(e) {
            if (!isResizing) return;
            
            const containerRect = document.querySelector('.main-content').getBoundingClientRect();
            const newLeftWidth = ((e.clientX - containerRect.left) / containerRect.width) * 100;
            
            if (newLeftWidth > 20 && newLeftWidth < 80) {
                editorPanel.style.flex = `0 0 ${newLeftWidth}%`;
                previewPanel.style.flex = `0 0 ${100 - newLeftWidth}%`;
            }
        }

        function stopResize() {
            isResizing = false;
            resizer.classList.remove('resizing');
            document.removeEventListener('mousemove', handleResize);
            document.removeEventListener('mouseup', stopResize);
        }

        // Initialize
        updatePreview();
        updateToolbarStates();
    </script>
</body>
</html>
